<!DOCTYPE html>
<html>
  <title>Pomodoro Timer</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="css/pomodoroStyle.css">
  <!-- Compiled and minified JavaScript -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script> -->
  <script src="js/timer.js"></script>

  <body>
    <div id="main" class="container">
      <div class="row">
        <div class="col s12">
          <div class="card blue-grey darken-1">
            <div class="card-content center-align white-text">
              <h1 id="title">Session</h1>
            </div>
          </div>
        </div>
        <div class="col s6">
          <div class="timer card black darken-1">
            <div class="card-content center-align white-text">
              <span id="displayMinutes">00</span>
            </div>
          </div>
        </div>
        <div class="col s6">
          <div class="timer card black darken-1">
            <div class="card-content center-align white-text">
              <span id="displaySeconds">00</span>
            </div>
          </div>
        </div>
          <div class="bottom-margin center-align col s12">
            <button id="start" class="col s12 btn waves-effect waves-light">Start</button>
          </div>
          <div class="col s12 m6">
            <div class="card blue-grey darken-1">
              <div class="card-content white-text">
                <span class="center-align card-title">Session Length</span>
                <div class="center-align">
                  <button class="btn-flat">
                    <i id="lowerSession" class="white-text material-icons">remove</i>
                  </button>

                  <span id="sessionField" >25</span>

                  <button class="btn-flat">
                    <i id="raiseSession" class="white-text material-icons">add</i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="col s12 m6">
            <div class="card blue-grey darken-1">
              <div class="card-content white-text">
                <span class="center-align card-title">Break Length</span>
                <p class="center-align">
                  <button class="btn-flat">
                    <i id="lowerBreak" class="white-text material-icons">remove</i>
                  </button>
                  <span id="breakField">05</span>
                  <button class="btn-flat">
                    <i id="raiseBreak" class="white-text material-icons">add</i>
                  </button>
                </p>
              </div>
            </div>
          </div>
      </div>

      <!-- <button id="reset">Reset</button> -->
    </div>

  <script>

    window.onload = function(){
      let displayMinutes = document.getElementById("displayMinutes");
      let displaySeconds = document.getElementById("displaySeconds");
      let sessionField = document.getElementById("sessionField");
      let breakField = document.getElementById("breakField");
      var theParent = document.getElementById("main");
      var timerButton = document.getElementById("start");

      // Initialize two timers
      var sessionTimer = new Timer("Session", 25, 200, 0, 1);
      var breakTimer = new Timer("Break", 5, 100, 0,1);

      // Todo: Build a method that toggles between break and session time.
      //  Assign the current timer to currentTimer.
      var currentTimer = sessionTimer;
      // Show current timer setting
      updateDisplay(currentTimer);

      // Create event listener to respond to different elements
      theParent.addEventListener("click", handleEvent, false);

      function handleEvent(event){
        if(event.target !== event.currentTarget){
          var clickedItem = event.target.id;
          console.log("Clicked:"+ clickedItem);

        }
        event.stopPropagation();
        switch(clickedItem){
          case "lowerSession":
            console.log("Decreased Session Time");
            sessionField.innerHTML = sessionTimer.decreaseValue();
            break;
          case "raiseSession":
            console.log("Increased Session Time");
            sessionField.innerHTML = sessionTimer.increaseValue();
            break;
          case "lowerBreak":
            console.log("Decreased Break Time");
            breakField.innerHTML = breakTimer.decreaseValue();
            break;
          case "raiseBreak":
            console.log("Increase Break Time");
            breakField.innerHTML = breakTimer.increaseValue();
            break;
          case "start":
            console.log("Start Counter");

            timerButton.setAttribute("id", "pause");
            timerButton.innerHTML = "Pause";
            counter(currentTimer);
            break;

          case "pause":
            console.log("Pause");
            clearTimeout(currentTimer.interval);
            timerButton.setAttribute("id", "start");
            timerButton.innerHTML = "Start";

        }
      }

      function updateDisplay(currentTimer){
        displayMinutes.innerHTML = currentTimer.getMinutes();
        displaySeconds.innerHTML = currentTimer.getSeconds();
      }

      function counter(currentTimer){
        currentTimer.interval = setInterval(function(){
            if(currentTimer.minutes == 0 && currentTimer.seconds == 0){
              clearTimeout(currentTimer.interval);

            } else if(currentTimer.seconds == 0){
              currentTimer.minutes -= 1;
              currentTimer.seconds = 59;
            }else {
              currentTimer.seconds -= 1;
            }

            updateDisplay(currentTimer);
        }, 1000);
      }
    }






  </script>
  </body>
</html>
