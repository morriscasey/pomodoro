<!DOCTYPE html>
<html>
  <title>Pomodoro Timer</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="css/pomodoroStyle.css">
  <!-- Compiled and minified JavaScript -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script> -->
  <script src="js/timer.js"></script>
  <script src="js/timeManager.js"></script>

  <body>
    <div id="main" class="container">
      <div class="row">
        <div class="col s12">
          <div class="card blue-grey darken-1">
            <div class="card-content center-align white-text">
              <h1 id="title">Session</h1>
            </div>
          </div>
        </div>
        <div class="col s6">
          <div class="timer card black darken-1">
            <div class="card-content center-align white-text">
              <span id="displayMinutes">00</span>
            </div>
          </div>
        </div>
        <div class="col s6">
          <div class="timer card black darken-1">
            <div class="card-content center-align white-text">
              <span id="displaySeconds">00</span>
            </div>
          </div>
        </div>
          <div class="bottom-margin center-align col s12 m10">
            <button id="start" class="col s12 btn waves-effect waves-light">Click to Start</button>
          </div>
          <div class="bottom-margin center-align col s12 m2">
            <button id="reset" class="col s12 btn waves-effect waves-light">Done?</button>
          </div>
          <div class="col s12 m6">
            <div class="card blue-grey darken-1">
              <div class="card-content white-text">
                <span class="center-align card-title">Session Length</span>
                <div class="center-align">
                  <button class="btn-flat">
                    <i id="lowerSession" class="white-text material-icons">remove</i>
                  </button>

                  <span id="sessionField" >25</span>

                  <button class="btn-flat">
                    <i id="raiseSession" class="white-text material-icons">add</i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="col s12 m6">
            <div class="card blue-grey darken-1">
              <div class="card-content white-text">
                <span class="center-align card-title">Break Length</span>
                <p class="center-align">
                  <button class="btn-flat">
                    <i id="lowerBreak" class="white-text material-icons">remove</i>
                  </button>
                  <span id="breakField">05</span>
                  <button class="btn-flat">
                    <i id="raiseBreak" class="white-text material-icons">add</i>
                  </button>
                </p>
              </div>
            </div>
          </div>
      </div>

    </div>

  <script>

    window.onload = function(){
      let displayMinutes = document.getElementById("displayMinutes");
      let displaySeconds = document.getElementById("displaySeconds");
      let sessionField = document.getElementById("sessionField");
      let breakField = document.getElementById("breakField");
      let titleField = document.getElementById("title");
      var theParent = document.getElementById("main");
      var timerButton = document.getElementById("start");
      var background = document.getElementById("timerBackground");
      var percentage = 0;
      var timeManager = new TimeManager();
      var activeTimer = timeManager.activeTimer;

      initialize();

      // Create event listener to respond to different elements
      theParent.addEventListener("click", handleEvent, false);

      function handleEvent(event){
        if(event.target !== event.currentTarget){
          var clickedItem = event.target.id;
          console.log("Clicked:"+ clickedItem);

        }
        event.stopPropagation();
        switch(clickedItem){

          case "lowerBreak":
            console.log("Decreased Break Time");
            breakField.innerHTML = padding(timeManager.breakTimer.decreaseValue());

            if(activeTimer.name == "Break"){
              setButton("start");
              activeTimer.pauseTimer();
              activeTimer.resetSeconds();
              updateDisplay(activeTimer);
            }
            break;
          case "raiseBreak":
            console.log("Increase Break Time");

            breakField.innerHTML = padding(timeManager.breakTimer.increaseValue());
            if(activeTimer.name == "Break"){
              setButton("start");
              activeTimer.pauseTimer();
              activeTimer.resetSeconds();
              updateDisplay(activeTimer);
            }
            break;
          case "lowerSession":
            console.log("Decreased Session Time:"+activeTimer.name);
            sessionField.innerHTML = padding(timeManager.sessionTimer.decreaseValue());

            if(activeTimer.name == "Session"){
              setButton("start");
              activeTimer.pauseTimer();
              activeTimer.resetSeconds();
              updateDisplay(activeTimer);
            }
            break;
          case "raiseSession":
            console.log("Increased Session Time");
            sessionField.innerHTML = padding(timeManager.sessionTimer.increaseValue());

            if(activeTimer.name == "Session"){
              setButton("start");
              activeTimer.pauseTimer();
              activeTimer.resetSeconds();
              updateDisplay(activeTimer);
            }
            break;
          case "start":
            console.log("Start Counter");

            setButton("pause");
            counter();
            break;

          case "pause":
            console.log("Pause");
            activeTimer.pauseTimer();
            setButton("start");
            break;
          case "reset":
            console.log("Reset");
            activeTimer.pauseTimer();
            activeTimer.resetSeconds();
            console.log(timeManager.sessionTimer.minutes);

            if(activeTimer.name == "Session"){
              activeTimer.minutes = parseInt(sessionField.innerHTML);
            }else{
              // Method swaps out session timer for break timer and visa versa.
              timeManager.changeActiveTimer();
              activeTimer = timeManager.activeTimer;
              initialize();
            }
            updateDisplay(activeTimer);
            break;

        }
      }
      // Add zeros as padding for numbers less than 10.
      function padding(value) {
          if(value < 10){
            return "0" + value;
          }else{
            return value;
          }
      }

      // Displays active timer
      function updateDisplay(currentTimer){
        console.log("Name:"+ currentTimer.name + "Min:"+currentTimer.minutes+"Sec:"+currentTimer.seconds);

        displayMinutes.innerHTML = padding(currentTimer.minutes);
        displaySeconds.innerHTML = padding(currentTimer.seconds);
      }

      // Runs set interval every second and counts down the minutes. Once minutes and seconds
      // reach zero than timer switches from sessions to break and back.
      function counter(){
        activeTimer.interval = setInterval(function(){
            if(activeTimer.minutes == 0 && activeTimer.seconds == 0){
              // Stops setInterval and changes the active timer interval to false.
              activeTimer.pauseTimer();
              // Resets active timer seconds to 0
              activeTimer.resetSeconds();
              // Condition resets the minutes for active timer back to the field selected.
              // Ex: if session is the active timer then sessionField's value determines what reset too.
              if(activeTimer.name == "Session"){
                activeTimer.minutes = parseInt(sessionField.innerHTML);
              }else{
                activeTimer.minutes = parseInt(breakField.innerHTML);
              }

              // Method swaps out session timer for break timer and visa versa.
              timeManager.changeActiveTimer();

              activeTimer = timeManager.activeTimer;
              // Changes the title and changes the display to match the new timer.
              initialize();
              // Starts the countdown process
              counter();

            } else if(activeTimer.seconds == 0){
              activeTimer.minutes -= 1;
              activeTimer.seconds = 59;
            }else {
              activeTimer.seconds -= 1;
            }

            updateDisplay(activeTimer);
        }, 1000);
      }

      function initialize(){
        titleField.innerHTML = activeTimer.name;
        updateDisplay(activeTimer);
      }

      function setButton(buttonId){
        timerButton.setAttribute("id", buttonId);
        timerButton.innerHTML = "Click to "+ buttonId.toUpperCase();
      }
    }






  </script>
  </body>
</html>
